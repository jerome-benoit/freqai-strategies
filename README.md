# FreqAI strategies

## Table of contents

- [QuickAdapter](#quickadapter)
  - [Quick start](#quick-start)
  - [Configuration tunables](#configuration-tunables)
- [ReforceXY](#reforcexy)
  - [Quick start](#quick-start-1)
  - [Supported models](#supported-models)
  - [Configuration tunables](#configuration-tunables-1)
- [Common workflows](#common-workflows)
- [Note](#note)

## QuickAdapter

### Quick start

Change the timezone according to your location in
[`docker-compose.yml`](./quickadapter/docker-compose.yml).

From the repository root, configure, build and start the QuickAdapter container:

```shell
cd quickadapter
cp user_data/config-template.json user_data/config.json
```

Adapt the configuration to your needs: edit `user_data/config.json` to set your
exchange API keys and tune the `freqai` section.

Then build and start the container:

```shell
docker compose up -d --build
```

### Configuration tunables

| Path                                                 | Default                       | Type / Range                                                                                                                               | Description                                                                                                                                                                                                                                                                                                                                                             |
| ---------------------------------------------------- | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| _Protections_                                        |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| custom_protections.trade_duration_candles            | 72                            | int >= 1                                                                                                                                   | Estimated trade duration in candles. Scales protections stop duration candles and trade limit.                                                                                                                                                                                                                                                                          |
| custom_protections.lookback_period_fraction          | 0.5                           | float (0,1]                                                                                                                                | Fraction of `fit_live_predictions_candles` used to calculate `lookback_period_candles` for _MaxDrawdown_ and _StoplossGuard_ protections.                                                                                                                                                                                                                               |
| custom_protections.cooldown.enabled                  | true                          | bool                                                                                                                                       | Enable/disable _CooldownPeriod_ protection.                                                                                                                                                                                                                                                                                                                             |
| custom_protections.cooldown.stop_duration_candles    | 4                             | int >= 1                                                                                                                                   | Number of candles to wait before allowing new trades after a trade is closed.                                                                                                                                                                                                                                                                                           |
| custom_protections.drawdown.enabled                  | true                          | bool                                                                                                                                       | Enable/disable _MaxDrawdown_ protection.                                                                                                                                                                                                                                                                                                                                |
| custom_protections.drawdown.max_allowed_drawdown     | 0.2                           | float (0,1)                                                                                                                                | Maximum allowed drawdown.                                                                                                                                                                                                                                                                                                                                               |
| custom_protections.stoploss.enabled                  | true                          | bool                                                                                                                                       | Enable/disable _StoplossGuard_ protection.                                                                                                                                                                                                                                                                                                                              |
| _Leverage_                                           |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| leverage                                             | `proposed_leverage`           | float [1.0, max_leverage]                                                                                                                  | Leverage. Fallback to `proposed_leverage` for the pair.                                                                                                                                                                                                                                                                                                                 |
| _Exit pricing_                                       |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| exit_pricing.trade_price_target                      | `moving_average`              | enum {`moving_average`,`quantile_interpolation`,`weighted_average`}                                                                        | Trade NATR computation method.                                                                                                                                                                                                                                                                                                                                          |
| exit_pricing.thresholds_calibration.decline_quantile | 0.75                          | float (0,1)                                                                                                                                | PnL decline quantile threshold.                                                                                                                                                                                                                                                                                                                                         |
| _Reversal confirmation_                              |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| reversal_confirmation.lookback_period                | 0                             | int >= 0                                                                                                                                   | Prior confirming candles; 0 = none.                                                                                                                                                                                                                                                                                                                                     |
| reversal_confirmation.decay_ratio                    | 0.5                           | float (0,1]                                                                                                                                | Geometric per-candle volatility adjusted reversal threshold relaxation factor.                                                                                                                                                                                                                                                                                          |
| reversal_confirmation.min_natr_ratio_percent         | 0.0095                        | float [0,1]                                                                                                                                | Lower bound fraction for volatility adjusted reversal threshold.                                                                                                                                                                                                                                                                                                        |
| reversal_confirmation.max_natr_ratio_percent         | 0.075                         | float [0,1]                                                                                                                                | Upper bound fraction (>= lower bound) for volatility adjusted reversal threshold.                                                                                                                                                                                                                                                                                       |
| _Regressor model_                                    |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| freqai.regressor                                     | `xgboost`                     | enum {`xgboost`,`lightgbm`}                                                                                                                | Machine learning regressor algorithm.                                                                                                                                                                                                                                                                                                                                   |
| _Extrema smoothing_                                  |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| freqai.extrema_smoothing.method                      | `gaussian`                    | enum {`gaussian`,`kaiser`,`triang`,`smm`,`sma`,`savgol`,`gaussian_filter1d`}                                                               | Extrema smoothing method (`smm`=median, `sma`=mean, `savgol`=Savitzky–Golay).                                                                                                                                                                                                                                                                                           |
| freqai.extrema_smoothing.window                      | 5                             | int >= 3                                                                                                                                   | Smoothing window length (candles).                                                                                                                                                                                                                                                                                                                                      |
| freqai.extrema_smoothing.beta                        | 8.0                           | float > 0                                                                                                                                  | Shape parameter for `kaiser` kernel.                                                                                                                                                                                                                                                                                                                                    |
| freqai.extrema_smoothing.polyorder                   | 3                             | int >= 1                                                                                                                                   | Polynomial order for `savgol` smoothing.                                                                                                                                                                                                                                                                                                                                |
| freqai.extrema_smoothing.mode                        | `mirror`                      | enum {`mirror`,`constant`,`nearest`,`wrap`,`interp`}                                                                                       | Boundary mode for `savgol` and `gaussian_filter1d`.                                                                                                                                                                                                                                                                                                                     |
| freqai.extrema_smoothing.sigma                       | 1.0                           | float > 0                                                                                                                                  | Gaussian `sigma` for `gaussian_filter1d` smoothing.                                                                                                                                                                                                                                                                                                                     |
| _Extrema weighting_                                  |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| freqai.extrema_weighting.strategy                    | `none`                        | enum {`none`,`amplitude`,`amplitude_threshold_ratio`,`volume_rate`,`speed`,`efficiency_ratio`,`volume_weighted_efficiency_ratio`,`hybrid`} | Extrema weighting source: unweighted (`none`), swing amplitude (`amplitude`), swing amplitude / median volatility-threshold ratio (`amplitude_threshold_ratio`), swing volume per candle (`volume_rate`), swing speed (`speed`), swing efficiency ratio (`efficiency_ratio`), swing volume-weighted efficiency ratio (`volume_weighted_efficiency_ratio`), or `hybrid`. |
| freqai.extrema_weighting.source_weights              | `{}`                          | dict[str, float]                                                                                                                           | Weights on extrema weighting sources for `hybrid`.                                                                                                                                                                                                                                                                                                                      |
| freqai.extrema_weighting.aggregation                 | `weighted_sum`                | enum {`weighted_sum`,`geometric_mean`}                                                                                                     | Aggregation method applied to weighted extrema weighting sources for `hybrid`.                                                                                                                                                                                                                                                                                          |
| freqai.extrema_weighting.aggregation_normalization   | `none`                        | enum {`minmax`,`sigmoid`,`softmax`,`l1`,`l2`,`rank`,`none`}                                                                                | Normalization method applied to the aggregated extrema weighting source for `hybrid`.                                                                                                                                                                                                                                                                                   |
| freqai.extrema_weighting.standardization             | `none`                        | enum {`none`,`zscore`,`robust`,`mmad`}                                                                                                     | Standardization method applied to weights before normalization. `none`=no standardization, `zscore`=(w-μ)/σ, `robust`=(w-median)/IQR, `mmad`=(w-median)/MAD.                                                                                                                                                                                                            |
| freqai.extrema_weighting.robust_quantiles            | [0.25, 0.75]                  | list[float] where 0 <= Q1 < Q3 <= 1                                                                                                        | Quantile range for robust standardization, Q1 and Q3.                                                                                                                                                                                                                                                                                                                   |
| freqai.extrema_weighting.mmad_scaling_factor         | 1.4826                        | float > 0                                                                                                                                  | Scaling factor for MMAD standardization.                                                                                                                                                                                                                                                                                                                                |
| freqai.extrema_weighting.normalization               | `minmax`                      | enum {`minmax`,`sigmoid`,`softmax`,`l1`,`l2`,`rank`,`none`}                                                                                | Normalization method applied to weights.                                                                                                                                                                                                                                                                                                                                |
| freqai.extrema_weighting.minmax_range                | [0.0, 1.0]                    | list[float]                                                                                                                                | Target range for `minmax` normalization, min and max.                                                                                                                                                                                                                                                                                                                   |
| freqai.extrema_weighting.sigmoid_scale               | 1.0                           | float > 0                                                                                                                                  | Scale parameter for `sigmoid` normalization, controls steepness.                                                                                                                                                                                                                                                                                                        |
| freqai.extrema_weighting.softmax_temperature         | 1.0                           | float > 0                                                                                                                                  | Temperature parameter for `softmax` normalization: lower values sharpen distribution, higher values flatten it.                                                                                                                                                                                                                                                         |
| freqai.extrema_weighting.rank_method                 | `average`                     | enum {`average`,`min`,`max`,`dense`,`ordinal`}                                                                                             | Ranking method for `rank` normalization.                                                                                                                                                                                                                                                                                                                                |
| freqai.extrema_weighting.gamma                       | 1.0                           | float (0,10]                                                                                                                               | Contrast exponent applied after normalization: >1 emphasizes extrema, values between 0 and 1 soften.                                                                                                                                                                                                                                                                    |
| _Feature parameters_                                 |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| freqai.feature_parameters.label_period_candles       | min/max midpoint              | int >= 1                                                                                                                                   | Zigzag labeling NATR horizon.                                                                                                                                                                                                                                                                                                                                           |
| freqai.feature_parameters.min_label_period_candles   | 12                            | int >= 1                                                                                                                                   | Minimum labeling NATR horizon used for reversals labeling HPO.                                                                                                                                                                                                                                                                                                          |
| freqai.feature_parameters.max_label_period_candles   | 24                            | int >= 1                                                                                                                                   | Maximum labeling NATR horizon used for reversals labeling HPO.                                                                                                                                                                                                                                                                                                          |
| freqai.feature_parameters.label_natr_ratio           | min/max midpoint              | float > 0                                                                                                                                  | Zigzag labeling NATR ratio.                                                                                                                                                                                                                                                                                                                                             |
| freqai.feature_parameters.min_label_natr_ratio       | 9.0                           | float > 0                                                                                                                                  | Minimum labeling NATR ratio used for reversals labeling HPO.                                                                                                                                                                                                                                                                                                            |
| freqai.feature_parameters.max_label_natr_ratio       | 12.0                          | float > 0                                                                                                                                  | Maximum labeling NATR ratio used for reversals labeling HPO.                                                                                                                                                                                                                                                                                                            |
| freqai.feature_parameters.label_frequency_candles    | `auto`                        | int >= 2 \| `auto`                                                                                                                         | Reversals labeling frequency. `auto` = max(2, 2 \* number of whitelisted pairs).                                                                                                                                                                                                                                                                                        |
| freqai.feature_parameters.label_metric               | `euclidean`                   | string (supported: `euclidean`,`minkowski`,`cityblock`,`chebyshev`,`mahalanobis`,`seuclidean`,`jensenshannon`,`sqeuclidean`,...)           | Metric used in distance calculations to ideal point.                                                                                                                                                                                                                                                                                                                    |
| freqai.feature_parameters.label_weights              | [1/7,1/7,1/7,1/7,1/7,1/7,1/7] | list[float]                                                                                                                                | Per-objective weights used in distance calculations to ideal point. Objectives: (1) number of detected reversals, (2) median swing amplitude, (3) median swing amplitude / median volatility-threshold ratio, (4) median swing volume per candle, (5) median swing speed, (6) median swing efficiency ratio, (7) median swing volume-weighted efficiency ratio.         |
| freqai.feature_parameters.label_p_order              | `None`                        | float \| None                                                                                                                              | p-order used by `minkowski` / `power_mean` (optional).                                                                                                                                                                                                                                                                                                                  |
| freqai.feature_parameters.label_medoid_metric        | `euclidean`                   | string                                                                                                                                     | Metric used with `medoid`.                                                                                                                                                                                                                                                                                                                                              |
| freqai.feature_parameters.label_kmeans_metric        | `euclidean`                   | string                                                                                                                                     | Metric used for k-means clustering.                                                                                                                                                                                                                                                                                                                                     |
| freqai.feature_parameters.label_kmeans_selection     | `min`                         | enum {`min`,`medoid`}                                                                                                                      | Strategy to select trial in the best k-means cluster.                                                                                                                                                                                                                                                                                                                   |
| freqai.feature_parameters.label_kmedoids_metric      | `euclidean`                   | string                                                                                                                                     | Metric used for k-medoids clustering.                                                                                                                                                                                                                                                                                                                                   |
| freqai.feature_parameters.label_kmedoids_selection   | `min`                         | enum {`min`,`medoid`}                                                                                                                      | Strategy to select trial in the best k-medoids cluster.                                                                                                                                                                                                                                                                                                                 |
| freqai.feature_parameters.label_knn_metric           | `minkowski`                   | string                                                                                                                                     | Distance metric for KNN.                                                                                                                                                                                                                                                                                                                                                |
| freqai.feature_parameters.label_knn_p_order          | `None`                        | float \| None                                                                                                                              | Tunable for KNN neighbor distances aggregation methods: p-order (`knn_power_mean`, default: 1.0) or quantile (`knn_quantile`, default: 0.5). (optional)                                                                                                                                                                                                                 |
| freqai.feature_parameters.label_knn_n_neighbors      | 5                             | int >= 1                                                                                                                                   | Number of neighbors for KNN.                                                                                                                                                                                                                                                                                                                                            |
| _Predictions extrema_                                |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| freqai.predictions_extrema.selection_method          | `rank_extrema`                | enum {`rank_extrema`,`rank_peaks`,`partition`}                                                                                             | Extrema selection method. `rank_extrema` ranks extrema values, `rank_peaks` ranks detected peak values, `partition` uses sign-based partitioning.                                                                                                                                                                                                                       |
| freqai.predictions_extrema.thresholds_smoothing      | `mean`                        | enum {`mean`,`isodata`,`li`,`minimum`,`otsu`,`triangle`,`yen`,`median`,`soft_extremum`}                                                    | Thresholding method for prediction thresholds smoothing.                                                                                                                                                                                                                                                                                                                |
| freqai.predictions_extrema.thresholds_alpha          | 12.0                          | float > 0                                                                                                                                  | Alpha for `soft_extremum` thresholds smoothing.                                                                                                                                                                                                                                                                                                                         |
| freqai.predictions_extrema.threshold_outlier         | 0.999                         | float (0,1)                                                                                                                                | Quantile threshold for predictions outlier filtering.                                                                                                                                                                                                                                                                                                                   |
| freqai.predictions_extrema.extrema_fraction          | 1.0                           | float (0,1]                                                                                                                                | Fraction of extrema used for thresholds. `1.0` uses all, lower values keep only most significant. Applies to `rank_extrema` and `rank_peaks`; ignored for `partition`.                                                                                                                                                                                                  |
| _Optuna / HPO_                                       |                               |                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                         |
| freqai.optuna_hyperopt.enabled                       | true                          | bool                                                                                                                                       | Enables HPO.                                                                                                                                                                                                                                                                                                                                                            |
| freqai.optuna_hyperopt.sampler                       | `tpe`                         | enum {`tpe`,`auto`}                                                                                                                        | HPO sampler algorithm. `tpe` uses [TPESampler](https://optuna.readthedocs.io/en/stable/reference/samplers/generated/optuna.samplers.TPESampler.html) with multivariate and group, `auto` uses [AutoSampler](https://hub.optuna.org/samplers/auto_sampler).                                                                                                              |
| freqai.optuna_hyperopt.storage                       | `file`                        | enum {`file`,`sqlite`}                                                                                                                     | HPO storage backend.                                                                                                                                                                                                                                                                                                                                                    |
| freqai.optuna_hyperopt.continuous                    | true                          | bool                                                                                                                                       | Continuous HPO.                                                                                                                                                                                                                                                                                                                                                         |
| freqai.optuna_hyperopt.warm_start                    | true                          | bool                                                                                                                                       | Warm start HPO with previous best value(s).                                                                                                                                                                                                                                                                                                                             |
| freqai.optuna_hyperopt.n_startup_trials              | 15                            | int >= 0                                                                                                                                   | HPO startup trials.                                                                                                                                                                                                                                                                                                                                                     |
| freqai.optuna_hyperopt.n_trials                      | 50                            | int >= 1                                                                                                                                   | Maximum HPO trials.                                                                                                                                                                                                                                                                                                                                                     |
| freqai.optuna_hyperopt.n_jobs                        | CPU threads / 4               | int >= 1                                                                                                                                   | Parallel HPO workers.                                                                                                                                                                                                                                                                                                                                                   |
| freqai.optuna_hyperopt.timeout                       | 7200                          | int >= 0                                                                                                                                   | HPO wall-clock timeout in seconds.                                                                                                                                                                                                                                                                                                                                      |
| freqai.optuna_hyperopt.label_candles_step            | 1                             | int >= 1                                                                                                                                   | Step for Zigzag NATR horizon search space.                                                                                                                                                                                                                                                                                                                              |
| freqai.optuna_hyperopt.train_candles_step            | 10                            | int >= 1                                                                                                                                   | Step for training sets size search space.                                                                                                                                                                                                                                                                                                                               |
| freqai.optuna_hyperopt.space_reduction               | false                         | bool                                                                                                                                       | Enable/disable HPO search space reduction based on previous best parameters.                                                                                                                                                                                                                                                                                            |
| freqai.optuna_hyperopt.expansion_ratio               | 0.4                           | float [0,1]                                                                                                                                | HPO search space expansion ratio.                                                                                                                                                                                                                                                                                                                                       |
| freqai.optuna_hyperopt.min_resource                  | 3                             | int >= 1                                                                                                                                   | Minimum resource per Hyperband pruner rung.                                                                                                                                                                                                                                                                                                                             |
| freqai.optuna_hyperopt.seed                          | 1                             | int >= 0                                                                                                                                   | HPO RNG seed.                                                                                                                                                                                                                                                                                                                                                           |

## ReforceXY

### Quick start

Change the timezone according to your location in
[`docker-compose.yml`](./ReforceXY/docker-compose.yml).

From the repository root, configure, build and start the ReforceXY container:

```shell
cd ReforceXY
cp user_data/config-template.json user_data/config.json
```

Adapt the configuration to your needs: edit `user_data/config.json` to set your
exchange API keys and tune the `freqai` section.

Then build and start the container:

```shell
docker compose up -d --build
```

### Supported models

PPO, MaskablePPO, RecurrentPPO, DQN, QRDQN

### Configuration tunables

The documented list of model tunables is at the top of the
[ReforceXY.py](./ReforceXY/user_data/freqaimodels/ReforceXY.py) file.

The rewarding logic and tunables are documented in the
[reward space analysis](./ReforceXY/reward_space_analysis/README.md).

## Common workflows

**List running compose services and the containers they created:**

```shell
docker compose ps
```

**Enter a running service:**

```shell
# use the compose service name (e.g. "freqtrade")
docker compose exec freqtrade /bin/sh
```

**View logs:**

```shell
# service logs (compose maps service -> container(s))
docker compose logs -f freqtrade

# or follow a specific container's logs
docker logs -f freqtrade-quickadapter
```

**Stop and remove the compose stack:**

```shell
docker compose down
```

**Automatically update docker images:**

```shell
cd ReforceXY  # or quickadapter
cp ../scripts/docker-upgrade.sh .
./docker-upgrade.sh
```

The script checks for new Freqtrade image versions on Docker Hub, rebuilds and
restarts containers if updates are found, sends Telegram notifications (if
configured), and cleans up unused images.

_Configuration and environment variables:_

| Variable            | Default                                  | Description                          |
| ------------------- | ---------------------------------------- | ------------------------------------ |
| FREQTRADE_CONFIG    | `./user_data/config.json`                | Freqtrade configuration file path    |
| LOCAL_DOCKER_IMAGE  | `reforcexy-freqtrade`                    | Local image name                     |
| REMOTE_DOCKER_IMAGE | `freqtradeorg/freqtrade:stable_freqairl` | Freqtrade image to track for updates |

_Cronjob setup (daily check at 3:00 AM):_

```cron
0 3 * * * cd /path/to/freqai-strategies/ReforceXY && ./docker-upgrade.sh >> user_data/logs/docker-upgrade.log 2>&1
```

---

## Note

> Do not expect any support of any kind on the Internet. Nevertheless, PRs
> implementing documentation, bug fixes, cleanups or sensible features will be
> discussed and might get merged.
